# Mawaru Station Front/Backend repo
Исходный код интернет-радио [Mawaru Station](http://mawaru.party/)

#### С чем имеем дело
Так сложилось исторически, что сервер интернет-радиостанций [liquidsoap](http://liquidsoap.info) не умеет в нормальную отдачу информации о том, что вообще внутри него происходит. Есть только два канала связи с ним -  telnet и unix-socket.
Для адекватного вывода информации необходима своя прослойка. 
Это - один из вариантов её реализации с применением NоdeJS и React.

#### На чем работает Mawaru Station
* Liquidsoap 1.3.3 (В репозиториях версия 1.1.1, с которой я не гарантирую совместимость, требуется сборка из исходников)
* Icecast 2.4.3

#### Back-end
Ничего особо сложного или сверхестественного, достаточно изучить то, какие ответы возвращает telnet и правильно их парсить.
Однако некоторые вещи не очевидны. \
\
Например, на запрос `mountpoint.status` вернется только on/off в зависимости играет ли поток. Информацию о текущем треке вытаскивать нужно из `mountpoint.metadata`(желательно) или `playlist.next`(не стоит).\
\
Если хочется управлять сервером через API, то стоит помнить, что перемешивание треков происходит через `playlist.reload` (его так же нужно вызывать при добавлении новых треков в каталог с музыкой. А вот пропуск через `mountpoint.skip`, вне зависимости от того, какой плейлист сейчас "в воздухе". Кстати, если маунтов несколько, то не важно к какому делать запрос.\
\
OGG/Vorbis, по моему мнению, предпочтительнее для работы с тегами, но это мое мнение.\
\
Исполнителя и название трека мы берем из тегов OGG потока. Если тегов нет, то в название трека летит название файла (на фронте исполнитель заменяется заглушкой).\
\
Все данные, полученные от нескольких запросов пишутся в MongoDB, откуда формируются в один JSON и отдаются по единственному роуту. Выглядит это примерно [так](http://mawaru.party:3001/status).
